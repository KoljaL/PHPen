<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Monaco editor</title>
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/editor/editor.main.min.css">
</head>

<body>

    <button id=ExecuteButton>RUN</button>
    <main>
        <div id="container" style="height:400px;border:1px solid black;"></div>
        <iframe id=iframe src="./files/default.php" frameborder="0"></iframe>
    </main>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"></script>
    <script>
        var editorContent;
        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs'
            }
        });
        require(["vs/editor/editor.main"], () => {
            const editor = monaco.editor.create(document.getElementById("container"), {
                value: `<?php echo date("l jS \of F Y h:i:s A");`,
                language: 'php',
                theme: 'vs-dark',
            });
            editorContent = editor.getValue()
        });
    </script>
    <script>
        //
        // define elements
        //
        var iframe = document.getElementById('iframe');
        var ExecuteButton = document.getElementById('ExecuteButton');

        window.addEventListener('load', (event) => {
            iframe.contentDocument.body.style.backgroundColor = "black";
            iframe.contentDocument.body.style.color = "grey";
        });


        iframe.addEventListener('load', (event) => {
            iframe.contentDocument.body.style.backgroundColor = "black";
            iframe.contentDocument.body.style.color = "grey";
        }, true)


        ExecuteButton.addEventListener('click', () => {
                editorContent = editor.getValue()

                fetch('handle.php?execute', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(editorContent),
                    })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log(data)
                        iframe.contentDocument.location.reload(true);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }) // ExecuteButton
    </script>

</body>
<style>
    main {
        display: flex;
    }
    
    iframe {
        width: 45%;
        border: 1px solid black;
    }
    
    #container {
        width: 45%;
    }
</style>

</html>